import spacy
from spacy import displacy

try:
    nlp = spacy.load("en_core_web_sm")
except IOError:
    print("Error: Model 'en_core_web_sm' not found.")
    print("Please run: python -m spacy download en_core_web_sm")
    exit()

text = ("Apple Inc. is planning to open a new office in Bangalore by 2026. "
        "Tim Cook, the CEO of Apple, announced this during his visit to India. "
        "Google and Microsoft are also expanding their operations in Asia.")

doc = nlp(text)

print("--- Named Entities Detected ---")
for ent in doc.ents:
    print(f"{ent.text} -> {ent.label_}")

print("\n--- Entity Details ---")
for ent in doc.ents:
    print(f"Text: {ent.text}, Label: {ent.label_}, Start: {ent.start_char}, End: {ent.end_char}")

true_entities = {
    ("Apple Inc.", "ORG"),
    ("Bangalore", "GPE"),
    ("2026", "DATE"),
    ("Tim Cook", "PERSON"),
    ("Apple", "ORG"),
    ("India", "GPE"),
    ("Google", "ORG"),
    ("Microsoft", "ORG"),
    ("Asia", "GPE")
}

pred_entities = {(ent.text, ent.label_) for ent in doc.ents}

print("\n--- 'True' (Manual) Entities ---")
print(true_entities)
print("\n--- 'Predicted' (spaCy) Entities ---")
print(pred_entities)

true_positives = len(true_entities & pred_entities)
false_positives = len(pred_entities - true_entities)
false_negatives = len(true_entities - pred_entities)

precision = true_positives / (true_positives + false_positives) if (true_positives + false_positives) > 0 else 0
recall = true_positives / (true_positives + false_negatives) if (true_positives + false_negatives) > 0 else 0
f1 = 2 * (precision * recall) / (precision + recall) if (precision + recall) > 0 else 0

print("\n--- Evaluation Metrics ---")
print(f"True Positives:  {true_positives}")
print(f"False Positives: {false_positives}")
print(f"False Negatives: {false_negatives}")
print(f"\nPrecision: {precision:.2f}")
print(f"Recall:    {recall:.2f}")
print(f"F1-Score:  {f1:.2f}")
